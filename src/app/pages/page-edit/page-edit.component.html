<section class="page-edit">
  <ng-container *ngIf="user()?.isAdmin; else noAccess">
    <form class="search" [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <label for="pageSearch" class="search-label">Search pages</label>
      <input
        id="pageSearch"
        type="search"
        formControlName="edit"
        placeholder="home"
        list="pagesList"
        autocomplete="off"
      />
      <datalist id="pagesList">
        <option *ngFor="let page of pages()" [value]="page['slug']"></option>
      </datalist>
      <button class="btn" type="submit">Search</button>
    </form>

    <p class="loading" *ngIf="loading()">Loading page…</p>

    <div class="page-preview" *ngIf="currentPageHtml() as html">
      <h2>Current content</h2>
      <div class="preview-content" [innerHTML]="html"></div>
    </div>

    <div class="editor-controls">
      <button class="btn" type="button" (click)="toggleEditForm()">
        {{ showEditForm() ? 'Hide editor' : 'Show editor' }}
      </button>
      <button class="btn" type="button" (click)="togglePreview()">
        {{ showPreview() ? 'Hide draft preview' : 'Show draft preview' }}
      </button>
    </div>

    <section class="editor" *ngIf="showEditForm()">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">
        <div class="field">
          <label for="title">Title *</label>
          <input id="title" type="text" formControlName="title" />
          <p class="validation" *ngIf="form.controls.title.invalid && form.controls.title.touched">
            Title is required.
          </p>
        </div>

        <div class="field">
          <label for="metaTitle">Meta title</label>
          <input id="metaTitle" type="text" formControlName="metaTitle" />
        </div>

        <div class="field">
          <label for="image">Image</label>
          <input id="image" type="text" formControlName="image" />
        </div>

        <div class="field">
          <label for="description">Description</label>
          <input id="description" type="text" formControlName="description" />
        </div>

        <div class="field">
          <label for="url">URL</label>
          <input id="url" type="text" formControlName="url" />
        </div>

        <div class="field">
          <label for="position">Position</label>
          <input id="position" type="number" formControlName="position" />
        </div>

        <div class="field">
          <label for="hidden">Hidden</label>
          <input id="hidden" type="text" formControlName="hidden" />
        </div>

        <div class="field">
          <label for="onlyHTML">Only HTML</label>
          <input id="onlyHTML" type="text" formControlName="onlyHTML" />
        </div>

        <div class="field">
          <label for="content">Content *</label>
          <textarea id="content" rows="12" formControlName="content"></textarea>
          <p class="validation" *ngIf="form.controls.content.invalid && form.controls.content.touched">
            Content is required.
          </p>
        </div>

        <div class="actions">
          <button type="submit" class="btn primary" [disabled]="pending()">
            {{ pending() ? 'Saving…' : 'Save changes' }}
          </button>
        </div>
      </form>

      <form class="delete" (ngSubmit)="deletePage()">
        <button type="submit" class="btn danger" [disabled]="deletePending()">
          {{ deletePending() ? 'Deleting…' : 'Delete page' }}
        </button>
      </form>
    </section>

    <div class="preview" *ngIf="previewContent() as preview">
      <h2>Draft preview</h2>
      <div class="preview-content" [innerHTML]="preview"></div>
    </div>

    <p class="error" *ngIf="errorMessage()">{{ errorMessage() }}</p>
    <p class="success" *ngIf="successMessage()">{{ successMessage() }}</p>
  </ng-container>

  <ng-template #noAccess>
    <p class="error">You need administrator rights to edit pages.</p>
  </ng-template>
</section>
